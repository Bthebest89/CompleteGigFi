const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BdgVNXf3.js","assets/web3-vendor-D-smDdvq.js","assets/react-vendor-oRnAdrvc.js","assets/ui-vendor-DvZrbspg.js","assets/index-afkGx5Ck.css"])))=>i.map(i=>d[i]);
import{_ as t}from"./web3-vendor-D-smDdvq.js";import{H as a,A as r,bF as e,J as s,B as o,y as n,b as i,af as c,_ as p,ad as d,ae as l,c as h,T as u}from"./index-BdgVNXf3.js";import{a as g,b as m,G as W,C as w}from"./contract-appuri-5c40af52.browser.esm-Bz6oVDxP.js";import{C as v}from"./contract-interceptor-d7b164a7.browser.esm-Dui4xQZ5.js";import"./react-vendor-oRnAdrvc.js";import"./ui-vendor-DvZrbspg.js";let y=function(t){return t[t.Against=0]="Against",t[t.For=1]="For",t[t.Abstain=2]="Abstain",t}({});class f{get chainId(){return this._chainId}constructor(t,o,n){let i=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:new a(t,o,i,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n);this._chainId=c,this.abi=r.parse(i||[]),this.contractWrapper=p,this.storage=n,this.metadata=new g(this.contractWrapper,e,this.storage),this.app=new m(this.contractWrapper,this.metadata,this.storage),this.encoder=new s(this.contractWrapper),this.estimator=new W(this.contractWrapper),this.events=new w(this.contractWrapper),this.interceptor=new v(this.contractWrapper)}onNetworkUpdated(t){this.contractWrapper.updateSignerOrProvider(t)}getAddress(){return this.contractWrapper.address}async get(t){const a=(await this.getAll()).filter((a=>a.proposalId.eq(o.from(t))));if(0===a.length)throw new Error("proposal not found");return a[0]}async getAll(){const t=await this.contractWrapper.read("getAllProposals",[])??[];return(await Promise.all(t.map((t=>Promise.all([this.contractWrapper.read("state",[t.proposalId]),this.getProposalVotes(t.proposalId)]))))).map(((a,r)=>{let[e,s]=a;const o=t[r];return{proposalId:o.proposalId,proposer:o.proposer,description:o.description,startBlock:o.startBlock,endBlock:o.endBlock,state:e,votes:s,executions:o[3].map(((t,a)=>({toAddress:o.targets[a],nativeTokenValue:t,transactionData:o.calldatas[a]})))}}))}async getProposalVotes(t){const a=await this.contractWrapper.read("proposalVotes",[t]);return[{type:y.Against,label:"Against",count:a.againstVotes},{type:y.For,label:"For",count:a.forVotes},{type:y.Abstain,label:"Abstain",count:a.abstainVotes}]}async hasVoted(t,a){return a||(a=await this.contractWrapper.getSignerAddress()),this.contractWrapper.read("hasVoted",[t,await n(a)])}async canExecute(t){await this.ensureExists(t);const a=await this.get(t),r=a.executions.map((t=>t.toAddress)),e=a.executions.map((t=>t.nativeTokenValue)),s=a.executions.map((t=>t.transactionData)),o=i(a.description);try{return await this.contractWrapper.callStatic().execute(r,e,s,o),!0}catch(n){return!1}}async balance(){const t=await this.contractWrapper.getProvider().getBalance(this.contractWrapper.address);return{name:"",symbol:"",decimals:18,value:t,displayValue:c(t,18)}}async balanceOfToken(a){const r=(await t((async()=>{const{default:t}=await import("./index-BdgVNXf3.js").then((t=>t.dV));return{default:t}}),__vite__mapDeps([0,1,2,3,4]))).default,e=new p(await n(a),r,this.contractWrapper.getProvider());return await d(this.contractWrapper.getProvider(),a,await e.balanceOf(this.contractWrapper.address))}async ensureExists(t){try{await this.contractWrapper.read("state",[t])}catch(a){throw Error(`Proposal ${t} not found`)}}async settings(){const[t,a,r,e,s]=await Promise.all([this.contractWrapper.read("votingDelay",[]),this.contractWrapper.read("votingPeriod",[]),this.contractWrapper.read("token",[]),this.contractWrapper.read("quorumNumerator",[]),this.contractWrapper.read("proposalThreshold",[])]),o=await l(this.contractWrapper.getProvider(),r);return{votingDelay:t.toString(),votingPeriod:a.toString(),votingTokenAddress:r,votingTokenMetadata:o,votingQuorumFraction:e.toString(),proposalTokenThreshold:s.toString()}}propose=h((async(t,a)=>{a||(a=[{toAddress:this.contractWrapper.address,nativeTokenValue:0,transactionData:"0x"}]);const r=a.map((t=>t.toAddress)),e=a.map((t=>t.nativeTokenValue)),s=a.map((t=>t.transactionData));return u.fromContractWrapper({contractWrapper:this.contractWrapper,method:"propose",args:[r,e,s,t],parse:t=>({id:this.contractWrapper.parseLogs("ProposalCreated",t?.logs)[0].args.proposalId,receipt:t})})}));vote=h((()=>{var t=this;return async function(a,r){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return await t.ensureExists(a),u.fromContractWrapper({contractWrapper:t.contractWrapper,method:"castVoteWithReason",args:[a,r,e]})}})());execute=h((async t=>{await this.ensureExists(t);const a=await this.get(t),r=a.executions.map((t=>t.toAddress)),e=a.executions.map((t=>t.nativeTokenValue)),s=a.executions.map((t=>t.transactionData)),o=i(a.description);return u.fromContractWrapper({contractWrapper:this.contractWrapper,method:"execute",args:[r,e,s,o]})}));async prepare(t,a,r){return u.fromContractWrapper({contractWrapper:this.contractWrapper,method:t,args:a,overrides:r})}async call(t,a,r){return this.contractWrapper.call(t,a,r)}}export{f as Vote};
//# sourceMappingURL=vote-e5646e80.browser.esm-BtHAkAkJ.js.map
